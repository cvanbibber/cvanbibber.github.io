{"ast":null,"code":"var _jsxFileName = \"C:\\\\Github\\\\cvanbibber.github.io\\\\src\\\\components\\\\CircuitField.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useCallback } from 'react';\nimport { useReducedMotion } from 'motion/react';\n\n// Redesigned CircuitField: subtle but technical\n// - Thick power rail shows electron flow (−) and V/I indicators\n// - Several low-voltage signal lines with positive carriers (+) easily pushed by a positive cursor\n// - Tasteful random pulses and electronics symbols (resistor, capacitor, diode, op-amp, ground)\n// - Performance: dual-canvas, DPR-capped, offscreen pause, reduced-motion static fallback\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CircuitField = () => {\n  _s();\n  const staticRef = useRef(null);\n  const dynamicRef = useRef(null);\n  const runningRef = useRef(false);\n  const rafRef = useRef(null);\n  const reduceMotion = useReducedMotion();\n  const dprRef = useRef(1);\n  const timeRef = useRef(0);\n  const mouse = useRef({\n    x: 0,\n    y: 0,\n    active: false,\n    charge: 1\n  }); // +1 positive probe, Alt toggles -1\n\n  const stateRef = useRef(null);\n  const rand = (a, b) => Math.random() * (b - a) + a;\n  const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));\n\n  // Build a left-to-right polyline with slight vertical variation\n  const makeSignal = (w, y, dpr, label, color, stiffness, tubeR) => {\n    const points = [];\n    const cols = 6;\n    for (let i = 0; i < cols; i++) {\n      const x = i / (cols - 1) * (w - 40 * dpr) + 20 * dpr; // 20px margin\n      const yj = y + rand(-8, 8) * dpr;\n      points.push({\n        x0: x,\n        y0: yj,\n        x,\n        y: yj\n      });\n    }\n    // Segments and total length\n    const segs = [];\n    let total = 0;\n    for (let i = 0; i < points.length - 1; i++) {\n      const ax = {\n        x: points[i].x,\n        y: points[i].y\n      };\n      const bx = {\n        x: points[i + 1].x,\n        y: points[i + 1].y\n      };\n      const len = Math.hypot(bx.x - ax.x, bx.y - ax.y);\n      segs.push({\n        ax,\n        bx,\n        len\n      });\n      total += len;\n    }\n    const carriers = new Array(9).fill(0).map((_, i) => ({\n      s: i / 9 * total,\n      v: rand(0.045, 0.08) * dpr,\n      charge: 1\n    }));\n    return {\n      points,\n      segs,\n      total,\n      carriers,\n      color,\n      tubeR,\n      label,\n      stiffness\n    };\n  };\n  const pointAt = (sig, s) => {\n    // wrap s into [0,total]\n    let d = s % sig.total;\n    if (d < 0) d += sig.total;\n    for (let i = 0; i < sig.segs.length; i++) {\n      const seg = sig.segs[i];\n      if (d <= seg.len) {\n        const t = seg.len ? d / seg.len : 0;\n        return {\n          x: seg.ax.x + (seg.bx.x - seg.ax.x) * t,\n          y: seg.ax.y + (seg.bx.y - seg.ax.y) * t\n        };\n      }\n      d -= seg.len;\n    }\n    // fallback end\n    const last = sig.segs[sig.segs.length - 1];\n    return {\n      x: last.bx.x,\n      y: last.bx.y\n    };\n  };\n  const drawSymbols = (ctx, syms, dpr) => {\n    ctx.save();\n    ctx.strokeStyle = 'rgba(148,163,184,0.55)'; // slate-400\n    ctx.fillStyle = 'rgba(148,163,184,0.7)';\n    ctx.lineWidth = 1 * dpr;\n    for (const s of syms) {\n      if (s.kind === 'ground') {\n        const {\n          x,\n          y\n        } = s.at;\n        ctx.beginPath();\n        ctx.moveTo(x, y - 10 * dpr);\n        ctx.lineTo(x, y - 2 * dpr);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(x - 6 * dpr, y);\n        ctx.lineTo(x + 6 * dpr, y);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(x - 4 * dpr, y + 3 * dpr);\n        ctx.lineTo(x + 4 * dpr, y + 3 * dpr);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(x - 2 * dpr, y + 6 * dpr);\n        ctx.lineTo(x + 2 * dpr, y + 6 * dpr);\n        ctx.stroke();\n      } else if (s.kind === 'resistor') {\n        const {\n          x,\n          y\n        } = s.at;\n        const ang = s.angle;\n        const ux = Math.cos(ang),\n          uy = Math.sin(ang);\n        const px = -uy,\n          py = ux;\n        ctx.beginPath();\n        const L = 24 * dpr;\n        const off = 4 * dpr;\n        ctx.moveTo(x - ux * L, y - uy * L);\n        for (let i = -5; i <= 5; i++) {\n          const zig = i % 2 === 0 ? off : -off;\n          const t = i / 5 * (L * 0.7);\n          ctx.lineTo(x + ux * t + px * zig, y + uy * t + py * zig);\n        }\n        ctx.lineTo(x + ux * L, y + uy * L);\n        ctx.stroke();\n      } else if (s.kind === 'capacitor') {\n        const {\n          x,\n          y\n        } = s.at;\n        const ang = s.angle;\n        const ux = Math.cos(ang),\n          uy = Math.sin(ang);\n        const px = -uy,\n          py = ux;\n        const L = 9 * dpr,\n          plate = 6 * dpr;\n        ctx.beginPath();\n        ctx.moveTo(x - ux * L + px * plate, y - uy * L + py * plate);\n        ctx.lineTo(x - ux * L - px * plate, y - uy * L - py * plate);\n        ctx.stroke();\n        ctx.beginPath();\n        ctx.moveTo(x + ux * L + px * plate, y + uy * L + py * plate);\n        ctx.lineTo(x + ux * L - px * plate, y + uy * L - py * plate);\n        ctx.stroke();\n      } else if (s.kind === 'diode') {\n        const {\n          x,\n          y\n        } = s.at;\n        const ang = s.angle;\n        const ux = Math.cos(ang),\n          uy = Math.sin(ang);\n        const px = -uy,\n          py = ux;\n        const L = 16 * dpr;\n        // triangle\n        ctx.beginPath();\n        ctx.moveTo(x - ux * L * 0.6, y - uy * L * 0.6);\n        ctx.lineTo(x, y);\n        ctx.lineTo(x - px * L * 0.5 - ux * L * 0.2, y - py * L * 0.5 - uy * L * 0.2);\n        ctx.closePath();\n        ctx.stroke();\n        // bar\n        ctx.beginPath();\n        ctx.moveTo(x + ux * L * 0.4 + px * L * 0.5, y + uy * L * 0.4 + py * L * 0.5);\n        ctx.lineTo(x + ux * L * 0.4 - px * L * 0.5, y + uy * L * 0.4 - py * L * 0.5);\n        ctx.stroke();\n      } else if (s.kind === 'opamp') {\n        const {\n          x,\n          y\n        } = s.at;\n        const ang = s.angle;\n        const ux = Math.cos(ang),\n          uy = Math.sin(ang);\n        const px = -uy,\n          py = ux;\n        const L = 22 * dpr;\n        // triangle body\n        ctx.beginPath();\n        ctx.moveTo(x - ux * L, y - uy * L);\n        ctx.lineTo(x + px * L * 0.6, y + py * L * 0.6);\n        ctx.lineTo(x - px * L * 0.6, y - py * L * 0.6);\n        ctx.closePath();\n        ctx.stroke();\n        // + and - inputs\n        ctx.font = `${Math.max(9, 10 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('+', x - px * L * 0.9, y - py * L * 0.9);\n        ctx.fillText('-', x + px * L * 0.9, y + py * L * 0.9);\n      }\n    }\n    ctx.restore();\n  };\n  const init = useCallback(() => {\n    const sCanvas = staticRef.current;\n    const dCanvas = dynamicRef.current;\n    if (!sCanvas || !dCanvas) return;\n    const rect = sCanvas.getBoundingClientRect();\n    const dpr = Math.min(window.devicePixelRatio || 1, 1.75); // cap for perf\n    dprRef.current = dpr;\n    const w = Math.max(1, Math.floor(rect.width * dpr));\n    const h = Math.max(1, Math.floor(rect.height * dpr));\n    sCanvas.width = w;\n    sCanvas.height = h;\n    dCanvas.width = w;\n    dCanvas.height = h;\n\n    // Power rail\n    const railY = Math.round(h * 0.22);\n    const rail = {\n      y: railY,\n      thickness: Math.max(3, 4 * dpr),\n      voltage: 5.0,\n      carriers: new Array(18).fill(0).map(() => ({\n        x: Math.random() * w,\n        v: (0.07 + Math.random() * 0.05) * dpr\n      }))\n    };\n\n    // Signals: lower voltage -> easier to deflect (lower stiffness)\n    const s1 = makeSignal(w, Math.round(h * 0.42), dpr, '0.8V', 'rgba(56,189,248,0.7)', 0.06, 8 * dpr);\n    const s2 = makeSignal(w, Math.round(h * 0.56), dpr, '1.2V', 'rgba(34,197,94,0.65)', 0.08, 9 * dpr);\n    const s3 = makeSignal(w, Math.round(h * 0.70), dpr, '3.3V', 'rgba(168,85,247,0.6)', 0.12, 10 * dpr);\n    const signals = [s1, s2, s3];\n\n    // Place some symbols aesthetically along signals\n    const symbols = [];\n    // Along s3: resistor and capacitor to ground\n    const pR = pointAt(s3, s3.total * 0.35);\n    symbols.push({\n      kind: 'resistor',\n      at: pR,\n      angle: 0\n    });\n    const pC = {\n      x: pR.x + 48 * dpr,\n      y: pR.y\n    };\n    symbols.push({\n      kind: 'capacitor',\n      at: pC,\n      angle: Math.PI / 2\n    });\n    // Diode on s2\n    const pD = pointAt(s2, s2.total * 0.6);\n    symbols.push({\n      kind: 'diode',\n      at: pD,\n      angle: 0\n    });\n    // Op-amp floating mid\n    symbols.push({\n      kind: 'opamp',\n      at: {\n        x: Math.round(w * 0.78),\n        y: Math.round(h * 0.48)\n      },\n      angle: 0\n    });\n    // Ground near bottom left\n    symbols.push({\n      kind: 'ground',\n      at: {\n        x: Math.round(w * 0.08),\n        y: Math.round(h * 0.88)\n      }\n    });\n    stateRef.current = {\n      w,\n      h,\n      rail,\n      signals,\n      symbols\n    };\n\n    // Static background: grid, power rail base, symbols, labels\n    const sctx = sCanvas.getContext('2d');\n    if (!sctx) return;\n    sctx.clearRect(0, 0, w, h);\n\n    // PCB grid\n    sctx.save();\n    sctx.strokeStyle = 'rgba(8,145,178,0.18)';\n    sctx.lineWidth = 1 * dpr;\n    const step = 72 * dpr;\n    for (let x = 0; x < w; x += step) {\n      sctx.beginPath();\n      sctx.moveTo(x, 0);\n      sctx.lineTo(x, h);\n      sctx.stroke();\n    }\n    for (let y = 0; y < h; y += step) {\n      sctx.beginPath();\n      sctx.moveTo(0, y);\n      sctx.lineTo(w, y);\n      sctx.stroke();\n    }\n    sctx.restore();\n\n    // Power rail line (thicker, subtle gradient)\n    const grad = sctx.createLinearGradient(0, rail.y, w, rail.y);\n    grad.addColorStop(0, 'rgba(239,68,68,0.35)');\n    grad.addColorStop(1, 'rgba(239,68,68,0.55)');\n    sctx.strokeStyle = grad;\n    sctx.lineWidth = rail.thickness;\n    sctx.beginPath();\n    sctx.moveTo(0, rail.y);\n    sctx.lineTo(w, rail.y);\n    sctx.stroke();\n    // Plus marks and voltage label\n    sctx.fillStyle = 'rgba(239,68,68,0.85)';\n    sctx.font = `${Math.max(10, 11 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\n    sctx.textAlign = 'left';\n    sctx.textBaseline = 'middle';\n    for (let x = 24 * dpr; x < w; x += 110 * dpr) sctx.fillText('+', x, rail.y - 7 * dpr);\n    sctx.fillText(`Vrail = ${rail.voltage.toFixed(1)}V`, 18 * dpr, rail.y - 18 * dpr);\n\n    // Static symbols\n    drawSymbols(sctx, symbols, dpr);\n  }, []);\n  const step = dt => {\n    const st = stateRef.current;\n    const canvas = dynamicRef.current;\n    if (!st || !canvas) return;\n    const {\n      w,\n      h,\n      rail,\n      signals\n    } = st;\n    const dpr = dprRef.current;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    timeRef.current += dt;\n\n    // Clear dynamic layer\n    ctx.clearRect(0, 0, w, h);\n\n    // Light wobble of signal control points (lower voltage -> looser)\n    for (const sig of signals) {\n      for (let i = 0; i < sig.points.length; i++) {\n        const p = sig.points[i];\n        // Keep x fixed; modulate y slightly\n        const a = (1 - sig.stiffness) * 5 * dpr; // amplitude\n        const wv = 0.001 + sig.stiffness * 0.003; // frequency\n        p.y = p.y0 + a * Math.sin((timeRef.current + i * 350) * wv);\n      }\n      // Recompute segments and total\n      sig.segs.length = 0;\n      sig.total = 0;\n      for (let i = 0; i < sig.points.length - 1; i++) {\n        const ax = {\n          x: sig.points[i].x,\n          y: sig.points[i].y\n        };\n        const bx = {\n          x: sig.points[i + 1].x,\n          y: sig.points[i + 1].y\n        };\n        const len = Math.hypot(bx.x - ax.x, bx.y - ax.y);\n        sig.segs.push({\n          ax,\n          bx,\n          len\n        });\n        sig.total += len;\n      }\n    }\n\n    // Draw signals (wire) and carriers (+)\n    ctx.lineWidth = 1 * dpr;\n    ctx.font = `${Math.max(8, 9 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    for (const sig of signals) {\n      // wire\n      ctx.strokeStyle = sig.color;\n      ctx.beginPath();\n      for (let i = 0; i < sig.points.length; i++) {\n        const p = sig.points[i];\n        if (i === 0) ctx.moveTo(p.x, p.y);else ctx.lineTo(p.x, p.y);\n      }\n      ctx.stroke();\n      // label\n      const mid = pointAt(sig, sig.total * 0.08);\n      ctx.fillStyle = 'rgba(148,163,184,0.9)';\n      ctx.fillText(sig.label, mid.x + 8 * dpr, mid.y - 8 * dpr);\n\n      // carriers\n      for (const c of sig.carriers) {\n        c.s += c.v * dt;\n        if (c.s > sig.total) c.s -= sig.total;\n        const base = pointAt(sig, c.s);\n\n        // Cursor interaction: positive cursor repels positive carriers strongly on low-V signals\n        let drawX = base.x,\n          drawY = base.y;\n        if (mouse.current.active) {\n          const mx = mouse.current.x * dpr,\n            my = mouse.current.y * dpr;\n          const dx = drawX - mx,\n            dy = drawY - my;\n          const r2 = dx * dx + dy * dy;\n          const R = (sig.tubeR * 5) ** 2; // influence area ~ 5x tube\n          if (r2 < R) {\n            const inv = 1 / Math.sqrt(r2 + 0.0001);\n            const dirx = dx * inv,\n              diry = dy * inv;\n            const strength = (1 - r2 / R) * (1.8 - sig.stiffness) * 26 * dpr; // softer if stiffer\n            const sign = mouse.current.charge * c.charge; // like charges repel\n            drawX += dirx * strength * sign;\n            drawY += diry * strength * sign;\n          }\n        }\n\n        // tube halo when displaced\n        const displaced = Math.hypot(drawX - base.x, drawY - base.y) > sig.tubeR * 0.6;\n        if (displaced) {\n          ctx.save();\n          ctx.strokeStyle = sig.color.replace('0.7', '0.25').replace('0.65', '0.25').replace('0.6', '0.25');\n          ctx.lineWidth = 2 * dpr;\n          ctx.beginPath();\n          ctx.moveTo(base.x, base.y);\n          ctx.lineTo(drawX, drawY);\n          ctx.stroke();\n          ctx.restore();\n        }\n\n        // carrier dot + label\n        ctx.fillStyle = 'rgba(252,211,77,0.9)'; // amber-ish for positive quasi-charges\n        ctx.beginPath();\n        ctx.arc(drawX, drawY, 1.5 * dpr, 0, Math.PI * 2);\n        ctx.fill();\n        ctx.fillStyle = 'rgba(252,211,77,0.95)';\n        ctx.fillText('+', drawX, drawY - 0.3 * dpr);\n      }\n    }\n\n    // Power rail electrons (−), minimally affected by cursor\n    let speedSum = 0;\n    ctx.fillStyle = 'rgba(14,165,233,0.95)';\n    for (const e of rail.carriers) {\n      e.x += e.v * dt;\n      if (e.x > w + 10 * dpr) e.x -= w + 20 * dpr;\n      speedSum += e.v;\n      let ex = e.x,\n        ey = rail.y;\n      if (mouse.current.active) {\n        const mx = mouse.current.x * dpr,\n          my = mouse.current.y * dpr;\n        const dx = ex - mx,\n          dy = ey - my;\n        const r2 = dx * dx + dy * dy;\n        const R = (80 * dpr) ** 2;\n        if (r2 < R) {\n          const inv = 1 / Math.sqrt(r2 + 0.0001);\n          const dirx = dx * inv,\n            diry = dy * inv;\n          // electrons are negative; positive cursor attracts (sign = -1)\n          const sign = -mouse.current.charge;\n          const strength = (1 - r2 / R) * 6 * dpr; // muted\n          ex += dirx * strength * sign;\n          ey += diry * strength * sign;\n        }\n      }\n      ctx.beginPath();\n      ctx.arc(ex, ey, 1.6 * dpr, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.fillStyle = 'rgba(14,165,233,0.95)';\n      ctx.font = `${Math.max(8, 9 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText('-', ex, ey - 0.4 * dpr);\n    }\n\n    // Current indicator (I) small meter top-right; approximate using speed sum\n    const Iraw = speedSum / rail.carriers.length; // px/ms\n    const norm = clamp((Iraw - 0.07 * dpr) / (0.12 * dpr), 0, 1);\n    const barW = 64 * dpr,\n      barH = 6 * dpr;\n    const bx = w - 90 * dpr,\n      by = rail.y - 22 * dpr;\n    ctx.save();\n    ctx.fillStyle = 'rgba(30,41,59,0.35)';\n    ctx.fillRect(bx, by, barW, barH);\n    ctx.fillStyle = 'rgba(34,197,94,0.85)';\n    ctx.fillRect(bx, by, barW * norm, barH);\n    ctx.fillStyle = 'rgba(148,163,184,0.9)';\n    ctx.font = `${Math.max(9, 10 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'bottom';\n    ctx.fillText('I (relative)', bx, by - 2 * dpr);\n    ctx.restore();\n\n    // Cursor glyph (probe)\n    if (mouse.current.active) {\n      ctx.save();\n      const mx = mouse.current.x * dpr,\n        my = mouse.current.y * dpr;\n      const col = mouse.current.charge > 0 ? 'rgba(239,68,68,0.75)' : 'rgba(59,130,246,0.75)';\n      ctx.strokeStyle = col;\n      ctx.lineWidth = 1.5 * dpr;\n      ctx.beginPath();\n      ctx.arc(mx, my, 14 * dpr, 0, Math.PI * 2);\n      ctx.stroke();\n      ctx.fillStyle = col;\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.font = `${Math.max(10, 11 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\n      ctx.fillText(mouse.current.charge > 0 ? '+' : '-', mx, my);\n      ctx.restore();\n    }\n  };\n  useEffect(() => {\n    const sCanvas = staticRef.current;\n    const dCanvas = dynamicRef.current;\n    if (!sCanvas || !dCanvas) return;\n    if (reduceMotion) {\n      init();\n      return;\n    }\n    init();\n    let last = performance.now(),\n      accum = 0;\n    const tick = now => {\n      if (!runningRef.current) return;\n      const frame = now - last;\n      last = now;\n      accum += frame;\n      if (accum >= 33) {\n        const dt = Math.min(33, accum);\n        accum = 0;\n        step(dt);\n      }\n      rafRef.current = requestAnimationFrame(tick);\n    };\n    const start = () => {\n      if (runningRef.current) return;\n      runningRef.current = true;\n      last = performance.now();\n      rafRef.current = requestAnimationFrame(tick);\n    };\n    const stop = () => {\n      runningRef.current = false;\n      if (rafRef.current) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    };\n\n    // Pause when offscreen\n    const io = new IntersectionObserver(entries => {\n      for (const e of entries) {\n        if (e.isIntersecting) start();else stop();\n      }\n    }, {\n      root: null,\n      threshold: 0.05\n    });\n    io.observe(dCanvas);\n\n    // Resize\n    const onResize = () => init();\n    window.addEventListener('resize', onResize);\n\n    // Mouse: positive by default, hold Alt to flip to negative\n    const onMove = e => {\n      mouse.current.x = e.clientX;\n      mouse.current.y = e.clientY;\n      mouse.current.active = true;\n    };\n    const onLeave = () => {\n      mouse.current.active = false;\n    };\n    const onKey = e => {\n      mouse.current.charge = e.altKey ? -1 : 1;\n    };\n    window.addEventListener('mousemove', onMove);\n    window.addEventListener('mouseleave', onLeave);\n    window.addEventListener('keydown', onKey);\n    window.addEventListener('keyup', onKey);\n    return () => {\n      stop();\n      io.disconnect();\n      window.removeEventListener('resize', onResize);\n      window.removeEventListener('mousemove', onMove);\n      window.removeEventListener('mouseleave', onLeave);\n      window.removeEventListener('keydown', onKey);\n      window.removeEventListener('keyup', onKey);\n    };\n  }, [reduceMotion, init]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"absolute inset-0 w-full h-full pointer-events-none select-none\",\n    \"aria-hidden\": true,\n    children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: staticRef,\n      className: \"absolute inset-0 w-full h-full\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: dynamicRef,\n      className: \"absolute inset-0 w-full h-full\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 425,\n    columnNumber: 5\n  }, this);\n};\n_s(CircuitField, \"0YA0SGJXhvRRwXVm0luLyjCsqy0=\", false, function () {\n  return [useReducedMotion];\n});\n_c = CircuitField;\nexport default CircuitField;\nvar _c;\n$RefreshReg$(_c, \"CircuitField\");","map":{"version":3,"names":["React","useEffect","useRef","useCallback","useReducedMotion","jsxDEV","_jsxDEV","CircuitField","_s","staticRef","dynamicRef","runningRef","rafRef","reduceMotion","dprRef","timeRef","mouse","x","y","active","charge","stateRef","rand","a","b","Math","random","clamp","v","lo","hi","max","min","makeSignal","w","dpr","label","color","stiffness","tubeR","points","cols","i","yj","push","x0","y0","segs","total","length","ax","bx","len","hypot","carriers","Array","fill","map","_","s","pointAt","sig","d","seg","t","last","drawSymbols","ctx","syms","save","strokeStyle","fillStyle","lineWidth","kind","at","beginPath","moveTo","lineTo","stroke","ang","angle","ux","cos","uy","sin","px","py","L","off","zig","plate","closePath","font","textAlign","textBaseline","fillText","restore","init","sCanvas","current","dCanvas","rect","getBoundingClientRect","window","devicePixelRatio","floor","width","h","height","railY","round","rail","thickness","voltage","s1","s2","s3","signals","symbols","pR","pC","PI","pD","sctx","getContext","clearRect","step","grad","createLinearGradient","addColorStop","toFixed","dt","st","canvas","p","wv","mid","c","base","drawX","drawY","mx","my","dx","dy","r2","R","inv","sqrt","dirx","diry","strength","sign","displaced","replace","arc","speedSum","e","ex","ey","Iraw","norm","barW","barH","by","fillRect","col","performance","now","accum","tick","frame","requestAnimationFrame","start","stop","cancelAnimationFrame","io","IntersectionObserver","entries","isIntersecting","root","threshold","observe","onResize","addEventListener","onMove","clientX","clientY","onLeave","onKey","altKey","disconnect","removeEventListener","className","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Github/cvanbibber.github.io/src/components/CircuitField.tsx"],"sourcesContent":["import React, { useEffect, useRef, useCallback } from 'react';\r\nimport { useReducedMotion } from 'motion/react';\r\n\r\n// Redesigned CircuitField: subtle but technical\r\n// - Thick power rail shows electron flow (−) and V/I indicators\r\n// - Several low-voltage signal lines with positive carriers (+) easily pushed by a positive cursor\r\n// - Tasteful random pulses and electronics symbols (resistor, capacitor, diode, op-amp, ground)\r\n// - Performance: dual-canvas, DPR-capped, offscreen pause, reduced-motion static fallback\r\n\r\ntype Vec2 = { x: number; y: number };\r\n\r\ntype Signal = {\r\n  points: Array<{ x0: number; y0: number; x: number; y: number }>; // control points\r\n  segs: Array<{ ax: Vec2; bx: Vec2; len: number }>;\r\n  total: number;\r\n  carriers: Array<{ s: number; v: number; charge: 1 | -1 }>; // s in [0,total]\r\n  color: string;\r\n  tubeR: number; // visual comfort radius\r\n  label: string; // e.g. 1.2V, 3.3V\r\n  stiffness: number; // curve wobble stiffness (higher -> stiffer)\r\n};\r\n\r\ntype SymbolDef =\r\n  | { kind: 'ground'; at: Vec2 }\r\n  | { kind: 'resistor'; at: Vec2; angle: number }\r\n  | { kind: 'capacitor'; at: Vec2; angle: number }\r\n  | { kind: 'diode'; at: Vec2; angle: number }\r\n  | { kind: 'opamp'; at: Vec2; angle: number };\r\n\r\nconst CircuitField: React.FC = () => {\r\n  const staticRef = useRef<HTMLCanvasElement | null>(null);\r\n  const dynamicRef = useRef<HTMLCanvasElement | null>(null);\r\n  const runningRef = useRef(false);\r\n  const rafRef = useRef<number | null>(null);\r\n  const reduceMotion = useReducedMotion();\r\n\r\n  const dprRef = useRef(1);\r\n  const timeRef = useRef(0);\r\n  const mouse = useRef({ x: 0, y: 0, active: false, charge: 1 as 1 | -1 }); // +1 positive probe, Alt toggles -1\r\n\r\n  const stateRef = useRef<\r\n    | {\r\n        w: number;\r\n        h: number;\r\n        rail: {\r\n          y: number;\r\n          thickness: number;\r\n          voltage: number; // volts\r\n          carriers: Array<{ x: number; v: number }>;\r\n        };\r\n        signals: Signal[];\r\n        symbols: SymbolDef[];\r\n      }\r\n    | null\r\n  >(null);\r\n\r\n  const rand = (a: number, b: number) => Math.random() * (b - a) + a;\r\n  const clamp = (v: number, lo: number, hi: number) => Math.max(lo, Math.min(hi, v));\r\n\r\n  // Build a left-to-right polyline with slight vertical variation\r\n  const makeSignal = (w: number, y: number, dpr: number, label: string, color: string, stiffness: number, tubeR: number): Signal => {\r\n    const points: Array<{ x0: number; y0: number; x: number; y: number }> = [];\r\n    const cols = 6;\r\n    for (let i = 0; i < cols; i++) {\r\n      const x = (i / (cols - 1)) * (w - 40 * dpr) + 20 * dpr; // 20px margin\r\n      const yj = y + rand(-8, 8) * dpr;\r\n      points.push({ x0: x, y0: yj, x, y: yj });\r\n    }\r\n    // Segments and total length\r\n    const segs: Array<{ ax: Vec2; bx: Vec2; len: number }> = [];\r\n    let total = 0;\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      const ax = { x: points[i].x, y: points[i].y };\r\n      const bx = { x: points[i + 1].x, y: points[i + 1].y };\r\n      const len = Math.hypot(bx.x - ax.x, bx.y - ax.y);\r\n      segs.push({ ax, bx, len });\r\n      total += len;\r\n    }\r\n    const carriers = new Array(9).fill(0).map((_, i) => ({ s: (i / 9) * total, v: rand(0.045, 0.08) * dpr, charge: 1 as 1 }));\r\n    return { points, segs, total, carriers, color, tubeR, label, stiffness };\r\n  };\r\n\r\n  const pointAt = (sig: Signal, s: number): Vec2 => {\r\n    // wrap s into [0,total]\r\n    let d = s % sig.total; if (d < 0) d += sig.total;\r\n    for (let i = 0; i < sig.segs.length; i++) {\r\n      const seg = sig.segs[i];\r\n      if (d <= seg.len) {\r\n        const t = seg.len ? d / seg.len : 0;\r\n        return { x: seg.ax.x + (seg.bx.x - seg.ax.x) * t, y: seg.ax.y + (seg.bx.y - seg.ax.y) * t };\r\n      }\r\n      d -= seg.len;\r\n    }\r\n    // fallback end\r\n    const last = sig.segs[sig.segs.length - 1];\r\n    return { x: last.bx.x, y: last.bx.y };\r\n  };\r\n\r\n  const drawSymbols = (ctx: CanvasRenderingContext2D, syms: SymbolDef[], dpr: number) => {\r\n    ctx.save();\r\n    ctx.strokeStyle = 'rgba(148,163,184,0.55)'; // slate-400\r\n    ctx.fillStyle = 'rgba(148,163,184,0.7)';\r\n    ctx.lineWidth = 1 * dpr;\r\n    for (const s of syms) {\r\n      if (s.kind === 'ground') {\r\n        const { x, y } = s.at;\r\n        ctx.beginPath(); ctx.moveTo(x, y - 10 * dpr); ctx.lineTo(x, y - 2 * dpr); ctx.stroke();\r\n        ctx.beginPath(); ctx.moveTo(x - 6 * dpr, y); ctx.lineTo(x + 6 * dpr, y); ctx.stroke();\r\n        ctx.beginPath(); ctx.moveTo(x - 4 * dpr, y + 3 * dpr); ctx.lineTo(x + 4 * dpr, y + 3 * dpr); ctx.stroke();\r\n        ctx.beginPath(); ctx.moveTo(x - 2 * dpr, y + 6 * dpr); ctx.lineTo(x + 2 * dpr, y + 6 * dpr); ctx.stroke();\r\n      } else if (s.kind === 'resistor') {\r\n        const { x, y } = s.at; const ang = s.angle;\r\n        const ux = Math.cos(ang), uy = Math.sin(ang);\r\n        const px = -uy, py = ux;\r\n        ctx.beginPath();\r\n        const L = 24 * dpr; const off = 4 * dpr;\r\n        ctx.moveTo(x - ux * L, y - uy * L);\r\n        for (let i = -5; i <= 5; i++) {\r\n          const zig = (i % 2 === 0 ? off : -off);\r\n          const t = (i / 5) * (L * 0.7);\r\n          ctx.lineTo(x + ux * t + px * zig, y + uy * t + py * zig);\r\n        }\r\n        ctx.lineTo(x + ux * L, y + uy * L);\r\n        ctx.stroke();\r\n      } else if (s.kind === 'capacitor') {\r\n        const { x, y } = s.at; const ang = s.angle;\r\n        const ux = Math.cos(ang), uy = Math.sin(ang);\r\n        const px = -uy, py = ux;\r\n        const L = 9 * dpr, plate = 6 * dpr;\r\n        ctx.beginPath(); ctx.moveTo(x - ux * L + px * plate, y - uy * L + py * plate);\r\n        ctx.lineTo(x - ux * L - px * plate, y - uy * L - py * plate); ctx.stroke();\r\n        ctx.beginPath(); ctx.moveTo(x + ux * L + px * plate, y + uy * L + py * plate);\r\n        ctx.lineTo(x + ux * L - px * plate, y + uy * L - py * plate); ctx.stroke();\r\n      } else if (s.kind === 'diode') {\r\n        const { x, y } = s.at; const ang = s.angle;\r\n        const ux = Math.cos(ang), uy = Math.sin(ang);\r\n        const px = -uy, py = ux;\r\n        const L = 16 * dpr;\r\n        // triangle\r\n        ctx.beginPath();\r\n        ctx.moveTo(x - ux * L * 0.6, y - uy * L * 0.6);\r\n        ctx.lineTo(x, y);\r\n        ctx.lineTo(x - px * L * 0.5 - ux * L * 0.2, y - py * L * 0.5 - uy * L * 0.2);\r\n        ctx.closePath(); ctx.stroke();\r\n        // bar\r\n        ctx.beginPath(); ctx.moveTo(x + ux * L * 0.4 + px * L * 0.5, y + uy * L * 0.4 + py * L * 0.5);\r\n        ctx.lineTo(x + ux * L * 0.4 - px * L * 0.5, y + uy * L * 0.4 - py * L * 0.5); ctx.stroke();\r\n      } else if (s.kind === 'opamp') {\r\n        const { x, y } = s.at; const ang = s.angle;\r\n        const ux = Math.cos(ang), uy = Math.sin(ang);\r\n        const px = -uy, py = ux;\r\n        const L = 22 * dpr;\r\n        // triangle body\r\n        ctx.beginPath();\r\n        ctx.moveTo(x - ux * L, y - uy * L);\r\n        ctx.lineTo(x + px * L * 0.6, y + py * L * 0.6);\r\n        ctx.lineTo(x - px * L * 0.6, y - py * L * 0.6);\r\n        ctx.closePath(); ctx.stroke();\r\n        // + and - inputs\r\n        ctx.font = `${Math.max(9, 10 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\r\n        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';\r\n        ctx.fillText('+', x - px * L * 0.9, y - py * L * 0.9);\r\n        ctx.fillText('-', x + px * L * 0.9, y + py * L * 0.9);\r\n      }\r\n    }\r\n    ctx.restore();\r\n  };\r\n\r\n  const init = useCallback(() => {\r\n    const sCanvas = staticRef.current;\r\n    const dCanvas = dynamicRef.current;\r\n    if (!sCanvas || !dCanvas) return;\r\n\r\n    const rect = sCanvas.getBoundingClientRect();\r\n    const dpr = Math.min(window.devicePixelRatio || 1, 1.75); // cap for perf\r\n    dprRef.current = dpr;\r\n    const w = Math.max(1, Math.floor(rect.width * dpr));\r\n    const h = Math.max(1, Math.floor(rect.height * dpr));\r\n    sCanvas.width = w; sCanvas.height = h;\r\n    dCanvas.width = w; dCanvas.height = h;\r\n\r\n    // Power rail\r\n    const railY = Math.round(h * 0.22);\r\n    const rail = {\r\n      y: railY,\r\n      thickness: Math.max(3, 4 * dpr),\r\n      voltage: 5.0,\r\n      carriers: new Array(18).fill(0).map(() => ({ x: Math.random() * w, v: (0.07 + Math.random() * 0.05) * dpr }))\r\n    };\r\n\r\n    // Signals: lower voltage -> easier to deflect (lower stiffness)\r\n    const s1 = makeSignal(w, Math.round(h * 0.42), dpr, '0.8V', 'rgba(56,189,248,0.7)', 0.06, 8 * dpr);\r\n    const s2 = makeSignal(w, Math.round(h * 0.56), dpr, '1.2V', 'rgba(34,197,94,0.65)', 0.08, 9 * dpr);\r\n    const s3 = makeSignal(w, Math.round(h * 0.70), dpr, '3.3V', 'rgba(168,85,247,0.6)', 0.12, 10 * dpr);\r\n    const signals = [s1, s2, s3];\r\n\r\n    // Place some symbols aesthetically along signals\r\n    const symbols: SymbolDef[] = [];\r\n    // Along s3: resistor and capacitor to ground\r\n    const pR = pointAt(s3, s3.total * 0.35); symbols.push({ kind: 'resistor', at: pR, angle: 0 });\r\n    const pC = { x: pR.x + 48 * dpr, y: pR.y }; symbols.push({ kind: 'capacitor', at: pC, angle: Math.PI / 2 });\r\n    // Diode on s2\r\n    const pD = pointAt(s2, s2.total * 0.6); symbols.push({ kind: 'diode', at: pD, angle: 0 });\r\n    // Op-amp floating mid\r\n    symbols.push({ kind: 'opamp', at: { x: Math.round(w * 0.78), y: Math.round(h * 0.48) }, angle: 0 });\r\n    // Ground near bottom left\r\n    symbols.push({ kind: 'ground', at: { x: Math.round(w * 0.08), y: Math.round(h * 0.88) } });\r\n\r\n    stateRef.current = { w, h, rail, signals, symbols };\r\n\r\n    // Static background: grid, power rail base, symbols, labels\r\n    const sctx = sCanvas.getContext('2d');\r\n    if (!sctx) return;\r\n    sctx.clearRect(0, 0, w, h);\r\n\r\n    // PCB grid\r\n    sctx.save();\r\n    sctx.strokeStyle = 'rgba(8,145,178,0.18)';\r\n    sctx.lineWidth = 1 * dpr;\r\n    const step = 72 * dpr;\r\n    for (let x = 0; x < w; x += step) { sctx.beginPath(); sctx.moveTo(x, 0); sctx.lineTo(x, h); sctx.stroke(); }\r\n    for (let y = 0; y < h; y += step) { sctx.beginPath(); sctx.moveTo(0, y); sctx.lineTo(w, y); sctx.stroke(); }\r\n    sctx.restore();\r\n\r\n    // Power rail line (thicker, subtle gradient)\r\n    const grad = sctx.createLinearGradient(0, rail.y, w, rail.y);\r\n    grad.addColorStop(0, 'rgba(239,68,68,0.35)');\r\n    grad.addColorStop(1, 'rgba(239,68,68,0.55)');\r\n    sctx.strokeStyle = grad;\r\n    sctx.lineWidth = rail.thickness;\r\n    sctx.beginPath(); sctx.moveTo(0, rail.y); sctx.lineTo(w, rail.y); sctx.stroke();\r\n    // Plus marks and voltage label\r\n    sctx.fillStyle = 'rgba(239,68,68,0.85)';\r\n    sctx.font = `${Math.max(10, 11 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\r\n    sctx.textAlign = 'left'; sctx.textBaseline = 'middle';\r\n    for (let x = 24 * dpr; x < w; x += 110 * dpr) sctx.fillText('+', x, rail.y - 7 * dpr);\r\n    sctx.fillText(`Vrail = ${rail.voltage.toFixed(1)}V`, 18 * dpr, rail.y - 18 * dpr);\r\n\r\n    // Static symbols\r\n    drawSymbols(sctx, symbols, dpr);\r\n  }, []);\r\n\r\n  const step = (dt: number) => {\r\n    const st = stateRef.current; const canvas = dynamicRef.current;\r\n    if (!st || !canvas) return;\r\n    const { w, h, rail, signals } = st; const dpr = dprRef.current;\r\n    const ctx = canvas.getContext('2d'); if (!ctx) return;\r\n    timeRef.current += dt;\r\n\r\n    // Clear dynamic layer\r\n    ctx.clearRect(0, 0, w, h);\r\n\r\n    // Light wobble of signal control points (lower voltage -> looser)\r\n    for (const sig of signals) {\r\n      for (let i = 0; i < sig.points.length; i++) {\r\n        const p = sig.points[i];\r\n        // Keep x fixed; modulate y slightly\r\n        const a = (1 - sig.stiffness) * 5 * dpr; // amplitude\r\n        const wv = 0.001 + sig.stiffness * 0.003; // frequency\r\n        p.y = p.y0 + a * Math.sin((timeRef.current + i * 350) * wv);\r\n      }\r\n      // Recompute segments and total\r\n      sig.segs.length = 0; sig.total = 0;\r\n      for (let i = 0; i < sig.points.length - 1; i++) {\r\n        const ax = { x: sig.points[i].x, y: sig.points[i].y };\r\n        const bx = { x: sig.points[i + 1].x, y: sig.points[i + 1].y };\r\n        const len = Math.hypot(bx.x - ax.x, bx.y - ax.y);\r\n        sig.segs.push({ ax, bx, len }); sig.total += len;\r\n      }\r\n    }\r\n\r\n    // Draw signals (wire) and carriers (+)\r\n    ctx.lineWidth = 1 * dpr;\r\n    ctx.font = `${Math.max(8, 9 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\r\n    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';\r\n    for (const sig of signals) {\r\n      // wire\r\n      ctx.strokeStyle = sig.color;\r\n      ctx.beginPath();\r\n      for (let i = 0; i < sig.points.length; i++) {\r\n        const p = sig.points[i]; if (i === 0) ctx.moveTo(p.x, p.y); else ctx.lineTo(p.x, p.y);\r\n      }\r\n      ctx.stroke();\r\n      // label\r\n      const mid = pointAt(sig, sig.total * 0.08);\r\n      ctx.fillStyle = 'rgba(148,163,184,0.9)';\r\n      ctx.fillText(sig.label, mid.x + 8 * dpr, mid.y - 8 * dpr);\r\n\r\n      // carriers\r\n      for (const c of sig.carriers) {\r\n        c.s += c.v * dt; if (c.s > sig.total) c.s -= sig.total;\r\n        const base = pointAt(sig, c.s);\r\n\r\n        // Cursor interaction: positive cursor repels positive carriers strongly on low-V signals\r\n        let drawX = base.x, drawY = base.y;\r\n        if (mouse.current.active) {\r\n          const mx = mouse.current.x * dpr, my = mouse.current.y * dpr;\r\n          const dx = drawX - mx, dy = drawY - my; const r2 = dx * dx + dy * dy;\r\n          const R = (sig.tubeR * 5) ** 2; // influence area ~ 5x tube\r\n          if (r2 < R) {\r\n            const inv = 1 / Math.sqrt(r2 + 0.0001);\r\n            const dirx = dx * inv, diry = dy * inv;\r\n            const strength = (1 - r2 / R) * (1.8 - sig.stiffness) * 26 * dpr; // softer if stiffer\r\n            const sign = mouse.current.charge * c.charge; // like charges repel\r\n            drawX += dirx * strength * sign;\r\n            drawY += diry * strength * sign;\r\n          }\r\n        }\r\n\r\n        // tube halo when displaced\r\n        const displaced = Math.hypot(drawX - base.x, drawY - base.y) > sig.tubeR * 0.6;\r\n        if (displaced) {\r\n          ctx.save();\r\n          ctx.strokeStyle = sig.color.replace('0.7', '0.25').replace('0.65', '0.25').replace('0.6', '0.25');\r\n          ctx.lineWidth = 2 * dpr;\r\n          ctx.beginPath(); ctx.moveTo(base.x, base.y); ctx.lineTo(drawX, drawY); ctx.stroke();\r\n          ctx.restore();\r\n        }\r\n\r\n        // carrier dot + label\r\n        ctx.fillStyle = 'rgba(252,211,77,0.9)'; // amber-ish for positive quasi-charges\r\n        ctx.beginPath(); ctx.arc(drawX, drawY, 1.5 * dpr, 0, Math.PI * 2); ctx.fill();\r\n        ctx.fillStyle = 'rgba(252,211,77,0.95)';\r\n        ctx.fillText('+', drawX, drawY - 0.3 * dpr);\r\n      }\r\n    }\r\n\r\n    // Power rail electrons (−), minimally affected by cursor\r\n    let speedSum = 0;\r\n    ctx.fillStyle = 'rgba(14,165,233,0.95)';\r\n    for (const e of rail.carriers) {\r\n      e.x += e.v * dt; if (e.x > w + 10 * dpr) e.x -= (w + 20 * dpr);\r\n      speedSum += e.v;\r\n      let ex = e.x, ey = rail.y;\r\n      if (mouse.current.active) {\r\n        const mx = mouse.current.x * dpr, my = mouse.current.y * dpr;\r\n        const dx = ex - mx, dy = ey - my; const r2 = dx * dx + dy * dy;\r\n        const R = (80 * dpr) ** 2;\r\n        if (r2 < R) {\r\n          const inv = 1 / Math.sqrt(r2 + 0.0001);\r\n          const dirx = dx * inv, diry = dy * inv;\r\n          // electrons are negative; positive cursor attracts (sign = -1)\r\n          const sign = -mouse.current.charge;\r\n          const strength = (1 - r2 / R) * 6 * dpr; // muted\r\n          ex += dirx * strength * sign;\r\n          ey += diry * strength * sign;\r\n        }\r\n      }\r\n      ctx.beginPath(); ctx.arc(ex, ey, 1.6 * dpr, 0, Math.PI * 2); ctx.fill();\r\n      ctx.fillStyle = 'rgba(14,165,233,0.95)'; ctx.font = `${Math.max(8, 9 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\r\n      ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('-', ex, ey - 0.4 * dpr);\r\n    }\r\n\r\n    // Current indicator (I) small meter top-right; approximate using speed sum\r\n    const Iraw = speedSum / rail.carriers.length; // px/ms\r\n    const norm = clamp((Iraw - 0.07 * dpr) / (0.12 * dpr), 0, 1);\r\n    const barW = 64 * dpr, barH = 6 * dpr; const bx = w - 90 * dpr, by = rail.y - 22 * dpr;\r\n    ctx.save();\r\n    ctx.fillStyle = 'rgba(30,41,59,0.35)'; ctx.fillRect(bx, by, barW, barH);\r\n    ctx.fillStyle = 'rgba(34,197,94,0.85)'; ctx.fillRect(bx, by, barW * norm, barH);\r\n    ctx.fillStyle = 'rgba(148,163,184,0.9)'; ctx.font = `${Math.max(9, 10 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\r\n    ctx.textAlign = 'left'; ctx.textBaseline = 'bottom';\r\n    ctx.fillText('I (relative)', bx, by - 2 * dpr);\r\n    ctx.restore();\r\n\r\n    // Cursor glyph (probe)\r\n    if (mouse.current.active) {\r\n      ctx.save();\r\n      const mx = mouse.current.x * dpr, my = mouse.current.y * dpr;\r\n      const col = mouse.current.charge > 0 ? 'rgba(239,68,68,0.75)' : 'rgba(59,130,246,0.75)';\r\n      ctx.strokeStyle = col; ctx.lineWidth = 1.5 * dpr;\r\n      ctx.beginPath(); ctx.arc(mx, my, 14 * dpr, 0, Math.PI * 2); ctx.stroke();\r\n      ctx.fillStyle = col; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';\r\n      ctx.font = `${Math.max(10, 11 * dpr)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;\r\n      ctx.fillText(mouse.current.charge > 0 ? '+' : '-', mx, my);\r\n      ctx.restore();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const sCanvas = staticRef.current; const dCanvas = dynamicRef.current;\r\n    if (!sCanvas || !dCanvas) return;\r\n\r\n    if (reduceMotion) { init(); return; }\r\n    init();\r\n\r\n    let last = performance.now(), accum = 0;\r\n    const tick = (now: number) => {\r\n      if (!runningRef.current) return;\r\n      const frame = now - last; last = now; accum += frame;\r\n      if (accum >= 33) { const dt = Math.min(33, accum); accum = 0; step(dt); }\r\n      rafRef.current = requestAnimationFrame(tick);\r\n    };\r\n    const start = () => { if (runningRef.current) return; runningRef.current = true; last = performance.now(); rafRef.current = requestAnimationFrame(tick); };\r\n    const stop = () => { runningRef.current = false; if (rafRef.current) cancelAnimationFrame(rafRef.current); rafRef.current = null; };\r\n\r\n    // Pause when offscreen\r\n    const io = new IntersectionObserver((entries) => { for (const e of entries) { if (e.isIntersecting) start(); else stop(); } }, { root: null, threshold: 0.05 });\r\n    io.observe(dCanvas);\r\n\r\n    // Resize\r\n    const onResize = () => init();\r\n    window.addEventListener('resize', onResize);\r\n\r\n    // Mouse: positive by default, hold Alt to flip to negative\r\n    const onMove = (e: MouseEvent) => { mouse.current.x = e.clientX; mouse.current.y = e.clientY; mouse.current.active = true; };\r\n    const onLeave = () => { mouse.current.active = false; };\r\n    const onKey = (e: KeyboardEvent) => { mouse.current.charge = e.altKey ? -1 : 1; };\r\n    window.addEventListener('mousemove', onMove);\r\n    window.addEventListener('mouseleave', onLeave);\r\n    window.addEventListener('keydown', onKey);\r\n    window.addEventListener('keyup', onKey);\r\n\r\n    return () => {\r\n      stop(); io.disconnect();\r\n      window.removeEventListener('resize', onResize);\r\n      window.removeEventListener('mousemove', onMove);\r\n      window.removeEventListener('mouseleave', onLeave);\r\n      window.removeEventListener('keydown', onKey);\r\n      window.removeEventListener('keyup', onKey);\r\n    };\r\n  }, [reduceMotion, init]);\r\n\r\n  return (\r\n    <div className=\"absolute inset-0 w-full h-full pointer-events-none select-none\" aria-hidden>\r\n      <canvas ref={staticRef} className=\"absolute inset-0 w-full h-full\" />\r\n      <canvas ref={dynamicRef} className=\"absolute inset-0 w-full h-full\" />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CircuitField;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}